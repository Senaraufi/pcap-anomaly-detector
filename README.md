# PCAP Anomaly Detector

A Python-based network traffic analyzer that parses PCAP files and detects suspicious domains and unusual traffic spikes.

## Features

- **PCAP Parsing**: Extract network traffic data from PCAP files using Scapy
- **Suspicious Domain Detection**: Identify potentially malicious domains using:
  - Pattern matching for suspicious TLDs and formats
  - DGA (Domain Generation Algorithm) detection
  - High entropy domain detection
  - Suspicious keyword identification
- **Traffic Spike Detection**: Detect unusual traffic patterns including:
  - Volume spikes over time
  - Abnormal IP activity
  - Unusual port usage
- **CLI Interface**: Easy-to-use command-line interface with colored output
- **Export Results**: Save analysis results to text files

## Installation

1. Clone the repository:
```bash
git clone <repository-url>
cd pcap-anomaly-detector
```

2. Install dependencies:
```bash
pip install -r requirements.txt
```

3. Install the package in development mode:
```bash
pip install -e .
```

## Usage

### Basic Analysis

Analyze a PCAP file for both suspicious domains and traffic spikes:

```bash
python -m pcap_analyzer analyze traffic.pcap
```

### Advanced Options

```bash
# Save results to a file
python -m pcap_analyzer analyze traffic.pcap --output results.txt

# Enable verbose logging
python -m pcap_analyzer analyze traffic.pcap --verbose

# Only analyze suspicious domains
python -m pcap_analyzer analyze traffic.pcap --domains-only

# Only analyze traffic spikes
python -m pcap_analyzer analyze traffic.pcap --traffic-only

# Get basic PCAP file information
python -m pcap_analyzer info traffic.pcap
```

### Python API

```python
from pcap_analyzer import PcapAnomalyDetector

# Initialize the detector
detector = PcapAnomalyDetector(verbose=True)

# Analyze a PCAP file
results = detector.analyze_file('traffic.pcap')

# Get summary
print(detector.get_summary(results))

# Access specific results
print(f"Suspicious domains: {len(results['suspicious_domains'])}")
print(f"Traffic spikes: {len(results['traffic_spikes'])}")
```

## Detection Methods

### Suspicious Domain Detection

The detector identifies suspicious domains using multiple techniques:

1. **Pattern Matching**: Detects domains matching known suspicious patterns
2. **TLD Analysis**: Flags domains from free TLDs often used maliciously (.tk, .ml, .ga, .cf)
3. **DGA Detection**: Identifies domains generated by algorithms
4. **Entropy Analysis**: Detects randomly-looking domains
5. **Keyword Matching**: Flags domains containing suspicious keywords
6. **Structural Analysis**: Identifies unusually long domains or excessive subdomains

### Traffic Spike Detection

Traffic anomalies are detected using statistical analysis:

1. **Volume Spikes**: Identifies unusual increases in traffic volume over time
2. **IP Activity Spikes**: Detects abnormal traffic from specific source/destination IPs
3. **Port Usage Spikes**: Identifies unusual activity on specific ports
4. **Statistical Thresholds**: Uses standard deviation to identify outliers

## Output

The analyzer provides:

- **Colored terminal output** for easy visualization
- **Tabulated results** showing top anomalies
- **Risk assessment** based on anomaly count
- **Detailed explanations** for each finding
- **Export capability** for further analysis

## Requirements

- Python 3.7+
- scapy >= 2.5.0
- click >= 8.1.0
- colorama >= 0.4.6
- tabulate >= 0.9.0
- python-dateutil >= 2.8.2

## Examples

### Example Output

```
PCAP Anomaly Detector
==================================================
✓ Successfully parsed 15420 packets

Analyzing suspicious domains...
Found 3 suspicious domains

Top Suspicious Domains:
+-------------------------+-------------+------------+------------------------+
| Domain                  | Risk Score  | Timestamp  | Reasons                |
+=========================+=============+============+========================+
| malware-site.tk         | 3           | 14:32:15   | Matches pattern: .*\.tk$ |
|                         |             |            | Contains keyword: malware |
+-------------------------+-------------+------------+------------------------+
| random-abc123.ml        | 2           | 14:33:42   | Matches pattern: .*\.ml$ |
|                         |             |            | High entropy (random-looking) |
+-------------------------+-------------+------------+------------------------+

Analyzing traffic spikes...
Found 2 traffic spikes

Top Traffic Spikes:
+---------------------+-------------+------------+------------+----------------------------------------+
| Type                | Target      | Severity   | Timestamp  | Description                            |
+=====================+=============+============+============+========================================+
| Volume Spike        | N/A         | 3.2σ       | 14:35:12   | Traffic spike: 5242880 bytes (mean:   |
|                     |             |            |            | 1048576, +3.2σ)                        |
+---------------------+-------------+------------+------------+----------------------------------------+

Analysis Summary:
==================================================
Total packets analyzed: 15420
DNS queries found: 89
Suspicious domains: 3
Traffic spikes: 2
Total anomalies: 5

⚠ Medium risk - multiple anomalies detected
```

## Contributing

1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Add tests if applicable
5. Submit a pull request

## License

This project is licensed under the MIT License - see the LICENSE file for details.

## Disclaimer

This tool is designed for network security analysis and educational purposes. Always ensure you have proper authorization before analyzing network traffic.

